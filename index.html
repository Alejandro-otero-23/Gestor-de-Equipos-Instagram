<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestor de Contactos Instagram</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Librer√≠a para manejar Excel (Exportar e Importar) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        .status-pendiente { background-color: #f3f4f6; color: #374151; border: 1px solid #d1d5db; }
        .status-enviado { background-color: #ebf8ff; color: #2b6cb0; border: 1px solid #bee3f8; }
        .status-conversacion { background-color: #f0fff4; color: #2f855a; border: 1px solid #c6f6d5; }
        .status-rechazado { background-color: #fff5f5; color: #c53030; border: 1px solid #fed7d7; }
        .status-finalizado { background-color: #faf5ff; color: #6b46c1; border: 1px solid #e9d8fd; }
        
        select.status-select {
            appearance: none;
            padding: 4px 12px;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 700;
            cursor: pointer;
            outline: none;
            transition: all 0.2s;
            min-width: 160px;
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen p-4 md:p-8">
    <div class="max-w-6xl mx-auto bg-white rounded-xl shadow-lg overflow-hidden">
        <div class="p-6 border-b border-gray-200 flex flex-col md:flex-row justify-between items-center gap-4">
            <div>
                <h1 class="text-2xl font-bold text-gray-800">üìã Registro de Equipos IG</h1>
                <p class="text-gray-500">Gestiona tus contactos, pa√≠ses y estados (Datos auto-guardados)</p>
            </div>
            <div class="flex gap-2">
                <!-- Bot√≥n de Importar -->
                <input type="file" id="importFile" class="hidden" accept=".xlsx, .xls" onchange="importFromExcel(event)">
                <button onclick="document.getElementById('importFile').click()" class="bg-blue-100 hover:bg-blue-200 text-blue-700 px-4 py-2 rounded-lg flex items-center gap-2 transition font-semibold border border-blue-200">
                    <span>üìÇ Importar Excel</span>
                </button>
                <button onclick="exportToExcel()" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg flex items-center gap-2 transition shadow-sm font-semibold">
                    <span>üì• Descargar Excel</span>
                </button>
            </div>
        </div>

        <!-- Formulario de Entrada -->
        <div class="p-6 bg-gray-50 border-b border-gray-200">
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-4">
                <input type="text" id="teamName" placeholder="Nombre del Equipo" class="p-2 border rounded-md focus:ring-2 focus:ring-blue-400 outline-none bg-white">
                <input type="text" id="clubCountry" placeholder="üìç Pa√≠s" class="p-2 border rounded-md focus:ring-2 focus:ring-blue-400 outline-none bg-white">
                <input type="text" id="igUser" placeholder="Usuario (@ejemplo)" class="p-2 border rounded-md focus:ring-2 focus:ring-blue-400 outline-none bg-white">
                <select id="status" class="p-2 border rounded-md bg-white cursor-pointer">
                    <option value="Pendiente">üïí Pendiente</option>
                    <option value="Enviado">üì© Enviado</option>
                    <option value="En Conversaci√≥n">üí¨ En Conversaci√≥n</option>
                    <option value="Rechazado">‚ùå Rechazado</option>
                    <option value="Finalizado">‚úÖ Finalizado</option>
                </select>
                <button onclick="addRow()" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg transition">
                    + Agregar
                </button>
            </div>
        </div>

        <!-- Tabla -->
        <div class="overflow-x-auto">
            <table class="w-full text-left border-collapse" id="mainTable">
                <thead>
                    <tr class="bg-gray-100 text-gray-600 uppercase text-xs font-semibold">
                        <th class="px-6 py-4 border-b">Equipo</th>
                        <th class="px-6 py-4 border-b">Pa√≠s</th>
                        <th class="px-6 py-4 border-b">Instagram</th>
                        <th class="px-6 py-4 border-b">Estado</th>
                        <th class="px-6 py-4 border-b text-center">Acciones</th>
                    </tr>
                </thead>
                <tbody id="tableBody">
                    <!-- Los datos se cargar√°n desde localStorage -->
                </tbody>
            </table>
        </div>
    </div>

    <script>
        // Cargar datos al iniciar
        window.onload = function() {
            loadFromLocalStorage();
        };

        function saveToLocalStorage() {
            const data = [];
            const trs = document.querySelectorAll('#tableBody tr');
            trs.forEach(tr => {
                data.push({
                    name: tr.cells[0].innerText,
                    country: tr.cells[1].innerText.replace('üìç ', ''),
                    user: tr.cells[2].innerText.replace('@', ''),
                    status: tr.cells[3].querySelector('select').value
                });
            });
            localStorage.setItem('igTeamsData', JSON.stringify(data));
        }

        function loadFromLocalStorage() {
            const saved = localStorage.getItem('igTeamsData');
            if (saved) {
                const data = JSON.parse(saved);
                const tableBody = document.getElementById('tableBody');
                tableBody.innerHTML = '';
                data.forEach(item => {
                    addRow(item.name, item.country, item.user, item.status, true);
                });
            }
        }

        function updateStatusStyle(selectElement) {
            selectElement.className = "status-select";
            const val = selectElement.value;
            
            if (val.includes("Pendiente")) selectElement.classList.add("status-pendiente");
            else if (val.includes("Enviado")) selectElement.classList.add("status-enviado");
            else if (val.includes("Conversaci√≥n")) selectElement.classList.add("status-conversacion");
            else if (val.includes("Rechazado")) selectElement.classList.add("status-rechazado");
            else if (val.includes("Finalizado")) selectElement.classList.add("status-finalizado");
            
            saveToLocalStorage(); // Guardar cambio de estado
        }

        function addRow(name = "", country = "", user = "", initialStatus = "", isLoading = false) {
            const teamName = name || document.getElementById('teamName').value;
            const clubCountry = country || document.getElementById('clubCountry').value;
            let igUser = (user || document.getElementById('igUser').value).replace('@', '');
            const status = initialStatus || document.getElementById('status').value;

            if (!teamName || !igUser) {
                if(!name) alert("Por favor completa al menos Equipo e Instagram.");
                return;
            }

            const tableBody = document.getElementById('tableBody');
            const row = document.createElement('tr');
            row.className = "hover:bg-gray-50 transition text-sm";
            
            let statusClass = "status-pendiente";
            if (status.includes("Enviado")) statusClass = "status-enviado";
            else if (status.includes("Conversaci√≥n")) statusClass = "status-conversacion";
            else if (status.includes("Rechazado")) statusClass = "status-rechazado";
            else if (status.includes("Finalizado")) statusClass = "status-finalizado";

            row.innerHTML = `
                <td class="px-6 py-4 border-b font-medium text-gray-800">${teamName}</td>
                <td class="px-6 py-4 border-b text-gray-600 font-medium">üìç ${clubCountry || 'N/A'}</td>
                <td class="px-6 py-4 border-b text-blue-600 font-semibold italic"><a href="https://instagram.com/${igUser}" target="_blank">@${igUser}</a></td>
                <td class="px-6 py-4 border-b">
                    <select onchange="updateStatusStyle(this)" class="status-select ${statusClass}">
                        <option value="Pendiente" ${status.includes('Pendiente') ? 'selected' : ''}>üïí Pendiente</option>
                        <option value="Enviado" ${status.includes('Enviado') ? 'selected' : ''}>üì© Enviado</option>
                        <option value="En Conversaci√≥n" ${status.includes('Conversaci√≥n') ? 'selected' : ''}>üí¨ En Conversaci√≥n</option>
                        <option value="Rechazado" ${status.includes('Rechazado') ? 'selected' : ''}>‚ùå Rechazado</option>
                        <option value="Finalizado" ${status.includes('Finalizado') ? 'selected' : ''}>‚úÖ Finalizado</option>
                    </select>
                </td>
                <td class="px-6 py-4 border-b text-center"><button onclick="deleteRow(this)" class="text-red-500 hover:text-red-700 font-bold">Eliminar</button></td>
            `;

            tableBody.appendChild(row);
            
            if(!isLoading) {
                saveToLocalStorage();
                if(!name) {
                    document.getElementById('teamName').value = '';
                    document.getElementById('clubCountry').value = '';
                    document.getElementById('igUser').value = '';
                }
            }
        }

        function deleteRow(btn) {
            btn.closest('tr').remove();
            saveToLocalStorage();
        }

        function exportToExcel() {
            const data = [["Equipo", "Pa√≠s", "Instagram", "Estado"]];
            const trs = document.querySelectorAll('#tableBody tr');
            
            trs.forEach(tr => {
                const team = tr.cells[0].innerText;
                const country = tr.cells[1].innerText.replace('üìç ', '');
                const ig = tr.cells[2].innerText;
                const status = tr.cells[3].querySelector('select').value;
                data.push([team, country, ig, status]);
            });

            const ws = XLSX.utils.aoa_to_sheet(data);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, "Equipos");
            XLSX.writeFile(wb, "Registro_Equipos_Instagram.xlsx");
        }

        function importFromExcel(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                const data = new Uint8Array(e.target.result);
                const workbook = XLSX.read(data, {type: 'array'});
                const firstSheetName = workbook.SheetNames[0];
                const worksheet = workbook.Sheets[firstSheetName];
                const json = XLSX.utils.sheet_to_json(worksheet, {header: 1});

                for(let i = 1; i < json.length; i++) {
                    const rowData = json[i];
                    if(rowData.length >= 2) {
                        addRow(
                            rowData[0] || "S/N", 
                            rowData[1] || "", 
                            rowData[2] || "", 
                            rowData[3] || "Pendiente"
                        );
                    }
                }
                alert("Importaci√≥n completada con √©xito");
                event.target.value = '';
            };
            reader.readAsArrayBuffer(file);
        }
    </script>
</body>
</html>
