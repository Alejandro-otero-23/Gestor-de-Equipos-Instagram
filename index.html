<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestor de Contactos Instagram</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- LibrerÃ­a para manejar Excel (Exportar e Importar) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        .status-pendiente { background-color: #f3f4f6; color: #374151; border: 1px solid #d1d5db; }
        .status-enviado { background-color: #ebf8ff; color: #2b6cb0; border: 1px solid #bee3f8; }
        .status-conversacion { background-color: #f0fff4; color: #2f855a; border: 1px solid #c6f6d5; }
        .status-rechazado { background-color: #fff5f5; color: #c53030; border: 1px solid #fed7d7; }
        .status-finalizado { background-color: #faf5ff; color: #6b46c1; border: 1px solid #e9d8fd; }
        
        select.status-select {
            appearance: none;
            padding: 4px 12px;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 700;
            cursor: pointer;
            outline: none;
            transition: all 0.2s;
            min-width: 160px;
        }

        .search-input {
            transition: all 0.3s ease;
        }
        .search-input:focus {
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen p-4 md:p-8 font-sans">
    <div class="max-w-7xl mx-auto bg-white rounded-xl shadow-lg overflow-hidden">
        <!-- Header -->
        <div class="p-6 border-b border-gray-200 flex flex-col md:flex-row justify-between items-center gap-4 bg-white sticky top-0 z-10">
            <div>
                <h1 class="text-2xl font-bold text-gray-800 flex items-center gap-2">
                    ğŸ“‹ Registro de Equipos IG
                </h1>
                <p class="text-gray-500 text-sm">Gestiona tus contactos, paÃ­ses y estados (Auto-guardado activo)</p>
            </div>
            <div class="flex flex-wrap gap-2 justify-center">
                <input type="file" id="importFile" class="hidden" accept=".xlsx, .xls" onchange="importFromExcel(event)">
                <button onclick="document.getElementById('importFile').click()" class="bg-blue-50 hover:bg-blue-100 text-blue-700 px-4 py-2 rounded-lg flex items-center gap-2 transition font-semibold border border-blue-200">
                    ğŸ“‚ Importar
                </button>
                <button onclick="exportToExcel()" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg flex items-center gap-2 transition shadow-sm font-semibold">
                    ğŸ“¥ Descargar Excel
                </button>
            </div>
        </div>

        <!-- Formulario de Entrada -->
        <div class="p-6 bg-gray-50 border-b border-gray-200">
            <h2 class="text-sm font-bold text-gray-400 uppercase mb-4 tracking-wider">AÃ±adir Nuevo Registro</h2>
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-6 gap-4">
                <input type="text" id="teamName" placeholder="Equipo" class="p-2 border rounded-md outline-none bg-white">
                <input type="text" id="clubCountry" placeholder="ğŸ“ PaÃ­s" class="p-2 border rounded-md outline-none bg-white">
                <input type="text" id="igUser" placeholder="Instagram (@...)" class="p-2 border rounded-md outline-none bg-white">
                <input type="date" id="contactDate" class="p-2 border rounded-md outline-none bg-white">
                <select id="status" class="p-2 border rounded-md bg-white cursor-pointer">
                    <option value="Pendiente">ğŸ•’ Pendiente</option>
                    <option value="Enviado">ğŸ“© Enviado</option>
                    <option value="En ConversaciÃ³n">ğŸ’¬ En ConversaciÃ³n</option>
                    <option value="Rechazado">âŒ Rechazado</option>
                    <option value="Finalizado">âœ… Finalizado</option>
                </select>
                <button onclick="addRow()" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg transition shadow-md">
                    + Agregar
                </button>
            </div>
        </div>

        <!-- Barra de BÃºsqueda / Filtros -->
        <div class="px-6 py-4 bg-white border-b border-gray-100">
            <div class="relative max-w-md">
                <span class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none text-gray-400">
                    ğŸ”
                </span>
                <input type="text" id="tableSearch" onkeyup="filterTable()" placeholder="Buscar por equipo, paÃ­s, IG o estado..." 
                    class="search-input block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-full leading-5 bg-gray-50 placeholder-gray-400 focus:outline-none focus:bg-white focus:border-blue-500 sm:text-sm">
            </div>
        </div>

        <!-- Tabla -->
        <div class="overflow-x-auto">
            <table class="w-full text-left border-collapse" id="mainTable">
                <thead>
                    <tr class="bg-gray-100 text-gray-600 uppercase text-[10px] font-bold tracking-widest">
                        <th class="px-6 py-4 border-b">Equipo</th>
                        <th class="px-6 py-4 border-b">PaÃ­s</th>
                        <th class="px-6 py-4 border-b">Instagram</th>
                        <th class="px-6 py-4 border-b">Fecha</th>
                        <th class="px-6 py-4 border-b">Estado</th>
                        <th class="px-6 py-4 border-b text-center">Acciones</th>
                    </tr>
                </thead>
                <tbody id="tableBody">
                    <!-- Datos dinÃ¡micos -->
                </tbody>
            </table>
        </div>
        
        <div id="noResults" class="hidden p-10 text-center text-gray-500 italic">
            No se encontraron resultados para tu bÃºsqueda.
        </div>
    </div>

    <script>
        // Establecer fecha de hoy por defecto en el input
        document.getElementById('contactDate').valueAsDate = new Date();

        window.onload = function() {
            loadFromLocalStorage();
        };

        function saveToLocalStorage() {
            const data = [];
            const trs = document.querySelectorAll('#tableBody tr');
            trs.forEach(tr => {
                data.push({
                    name: tr.cells[0].innerText,
                    country: tr.cells[1].innerText.replace('ğŸ“ ', ''),
                    user: tr.cells[2].innerText.replace('@', ''),
                    date: tr.cells[3].querySelector('input') ? tr.cells[3].querySelector('input').value : tr.cells[3].innerText,
                    status: tr.cells[4].querySelector('select').value
                });
            });
            localStorage.setItem('igTeamsData', JSON.stringify(data));
        }

        function loadFromLocalStorage() {
            const saved = localStorage.getItem('igTeamsData');
            if (saved) {
                const data = JSON.parse(saved);
                const tableBody = document.getElementById('tableBody');
                tableBody.innerHTML = '';
                data.forEach(item => {
                    addRow(item.name, item.country, item.user, item.status, item.date, true);
                });
            }
        }

        function filterTable() {
            const input = document.getElementById('tableSearch');
            const filter = input.value.toLowerCase();
            const table = document.getElementById('tableBody');
            const trs = table.getElementsByTagName('tr');
            let hasResults = false;

            for (let i = 0; i < trs.length; i++) {
                const textContent = trs[i].textContent.toLowerCase();
                const statusValue = trs[i].cells[4].querySelector('select').value.toLowerCase();
                
                if (textContent.includes(filter) || statusValue.includes(filter)) {
                    trs[i].style.display = "";
                    hasResults = true;
                } else {
                    trs[i].style.display = "none";
                }
            }

            document.getElementById('noResults').style.display = hasResults ? "none" : "block";
        }

        function updateStatusStyle(selectElement) {
            selectElement.className = "status-select";
            const val = selectElement.value;
            
            if (val.includes("Pendiente")) selectElement.classList.add("status-pendiente");
            else if (val.includes("Enviado")) selectElement.classList.add("status-enviado");
            else if (val.includes("ConversaciÃ³n")) selectElement.classList.add("status-conversacion");
            else if (val.includes("Rechazado")) selectElement.classList.add("status-rechazado");
            else if (val.includes("Finalizado")) selectElement.classList.add("status-finalizado");
            
            saveToLocalStorage();
        }

        function addRow(name = "", country = "", user = "", initialStatus = "", initialDate = "", isLoading = false) {
            const teamName = name || document.getElementById('teamName').value;
            const clubCountry = country || document.getElementById('clubCountry').value;
            let igUser = (user || document.getElementById('igUser').value).replace('@', '');
            const status = initialStatus || document.getElementById('status').value;
            const rowDate = initialDate || document.getElementById('contactDate').value;

            if (!teamName || !igUser) {
                if(!isLoading) alert("Por favor completa al menos Equipo e Instagram.");
                return;
            }

            const tableBody = document.getElementById('tableBody');
            const row = document.createElement('tr');
            row.className = "hover:bg-gray-50 transition text-sm border-b border-gray-100";
            
            let statusClass = "status-pendiente";
            if (status.includes("Enviado")) statusClass = "status-enviado";
            else if (status.includes("ConversaciÃ³n")) statusClass = "status-conversacion";
            else if (status.includes("Rechazado")) statusClass = "status-rechazado";
            else if (status.includes("Finalizado")) statusClass = "status-finalizado";

            row.innerHTML = `
                <td class="px-6 py-4 font-medium text-gray-800">${teamName}</td>
                <td class="px-6 py-4 text-gray-600">ğŸ“ ${clubCountry || 'N/A'}</td>
                <td class="px-6 py-4 text-blue-600 font-semibold italic"><a href="https://instagram.com/${igUser}" target="_blank">@${igUser}</a></td>
                <td class="px-6 py-4 text-gray-500">
                    <input type="date" value="${rowDate}" onchange="saveToLocalStorage()" class="bg-transparent outline-none focus:border-b border-blue-200">
                </td>
                <td class="px-6 py-4">
                    <select onchange="updateStatusStyle(this)" class="status-select ${statusClass}">
                        <option value="Pendiente" ${status.includes('Pendiente') ? 'selected' : ''}>ğŸ•’ Pendiente</option>
                        <option value="Enviado" ${status.includes('Enviado') ? 'selected' : ''}>ğŸ“© Enviado</option>
                        <option value="En ConversaciÃ³n" ${status.includes('ConversaciÃ³n') ? 'selected' : ''}>ğŸ’¬ En ConversaciÃ³n</option>
                        <option value="Rechazado" ${status.includes('Rechazado') ? 'selected' : ''}>âŒ Rechazado</option>
                        <option value="Finalizado" ${status.includes('Finalizado') ? 'selected' : ''}>âœ… Finalizado</option>
                    </select>
                </td>
                <td class="px-6 py-4 text-center">
                    <button onclick="deleteRow(this)" class="text-gray-300 hover:text-red-500 transition-colors p-2 rounded-full hover:bg-red-50">
                        ğŸ—‘ï¸
                    </button>
                </td>
            `;

            tableBody.appendChild(row);
            
            if(!isLoading) {
                saveToLocalStorage();
                document.getElementById('teamName').value = '';
                document.getElementById('clubCountry').value = '';
                document.getElementById('igUser').value = '';
                document.getElementById('contactDate').valueAsDate = new Date();
            }
        }

        function deleteRow(btn) {
            if(confirm("Â¿EstÃ¡s seguro de que quieres eliminar este equipo?")) {
                btn.closest('tr').remove();
                saveToLocalStorage();
                filterTable();
            }
        }

        function exportToExcel() {
            const data = [["Equipo", "PaÃ­s", "Instagram", "Fecha", "Estado"]];
            const trs = document.querySelectorAll('#tableBody tr');
            
            trs.forEach(tr => {
                const team = tr.cells[0].innerText;
                const country = tr.cells[1].innerText.replace('ğŸ“ ', '');
                const ig = tr.cells[2].innerText;
                const date = tr.cells[3].querySelector('input').value;
                const status = tr.cells[4].querySelector('select').value;
                data.push([team, country, ig, date, status]);
            });

            const ws = XLSX.utils.aoa_to_sheet(data);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, "Contactos");
            XLSX.writeFile(wb, "Registro_Contactos_IG.xlsx");
        }

        function importFromExcel(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                const data = new Uint8Array(e.target.result);
                const workbook = XLSX.read(data, {type: 'array'});
                const worksheet = workbook.Sheets[workbook.SheetNames[0]];
                const json = XLSX.utils.sheet_to_json(worksheet, {header: 1});

                for(let i = 1; i < json.length; i++) {
                    const row = json[i];
                    if(row[0] || row[2]) {
                        addRow(
                            row[0] || "Sin nombre", 
                            row[1] || "", 
                            row[2] || "", 
                            row[4] || "Pendiente",
                            row[3] || new Date().toISOString().split('T')[0]
                        );
                    }
                }
                alert("ImportaciÃ³n finalizada.");
                event.target.value = '';
            };
            reader.readAsArrayBuffer(file);
        }
    </script>
</body>
</html>
